<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SafeView - Private Content</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            background: #09090b; color: #fafafa;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            display: flex; align-items: center; justify-content: center;
            height: 100vh; margin: 0; user-select: none; -webkit-user-select: none;
        }
        .card {
            width: 85%; padding: 24px; border-radius: 16px;
            background: #18181b; border: 1px solid #27272a; text-align: center;
        }
        .content-area {
            background: #000; color: #22c55e; padding: 20px;
            border-radius: 12px; margin: 20px 0; font-family: 'Courier New', monospace;
            filter: blur(12px); transition: 0.3s; word-wrap: break-word;
        }
        .content-area.active { filter: blur(0); }
        .hint { font-size: 0.8em; color: #71717a; }
        #timer { color: #ef4444; font-weight: bold; }
    </style>
</head>
<body>
    <div class="card" id="main-card">
        <h3>üîí –ó–∞—â–∏—â–µ–Ω–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä</h3>
        <p id="info">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
        <div id="content" class="content-area">–ó–∞–∂–º–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</div>
        <p class="hint">–£–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –ø–∞–ª–µ—Ü –Ω–∞ —á–µ—Ä–Ω–æ–º –ø–æ–ª–µ.<br>–î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —Å—Ç–µ—Ä—Ç—ã —á–µ—Ä–µ–∑ <span id="timer">20</span>—Å.</p>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        const params = new URLSearchParams(window.location.search);
        const token = params.get('token');
        // –ó–ê–ú–ï–ù–ò –ù–ê IP –°–í–û–ï–ì–û –¢–ê–ô–ú–í–ï–ë–ê:
        const API_URL = "http://–¢–í–û–ô_IP_TIMEWEB:8000"; 

        async function init() {
            try {
                const res = await fetch(`${API_URL}/get_secret/${token}`);
                if (!res.ok) throw new Error();
                const data = await res.json();
                
                const box = document.getElementById('content');
                box.innerText = data.content;
                document.getElementById('info').innerText = "–î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã –∏ —Å—Ç–µ—Ä—Ç—ã —Å —Å–µ—Ä–≤–µ—Ä–∞.";
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞—Å–∞–Ω–∏–π
                const reveal = () => box.classList.add('active');
                const hide = () => box.classList.remove('active');
                box.addEventListener('touchstart', reveal);
                box.addEventListener('touchend', hide);
                box.addEventListener('mousedown', reveal);
                box.addEventListener('mouseup', hide);

                startCountdown(20);
            } catch (e) {
                document.getElementById('main-card').innerHTML = "<h3>‚ùå –û—à–∏–±–∫–∞</h3><p>–°—Å—ã–ª–∫–∞ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞.</p>";
            }
        }

        function startCountdown(sec) {
            let left = sec;
            const el = document.getElementById('timer');
            const itv = setInterval(() => {
                left--;
                el.innerText = left;
                if(left <= 0) {
                    clearInterval(itv);
                    tg.close();
                }
            }, 1000);
        }

        if(token) init();
    </script>
</body>
</html>